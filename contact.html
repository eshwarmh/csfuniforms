<div class="contact-form slide-right">
    <h2>Send Us a Message</h2>
    
    <!-- Enhanced Contact Form with Multiple Submission Options -->
    <form id="csfContactForm" class="validate-form">
        <!-- Formspree as Primary Submission Method -->
        <input type="hidden" name="_formsubmit_id" value="csf_uniforms_contact">
        
        <div class="form-group">
            <label for="name">Your Name*</label>
            <input type="text" id="name" name="name" required minlength="2" class="input-field">
            <span class="validation-error"></span>
        </div>
        
        <div class="form-group">
            <label for="email">Email Address*</label>
            <input type="email" id="email" name="email" required class="input-field">
            <span class="validation-error"></span>
        </div>
        
        <div class="form-group">
            <label for="phone">Phone Number</label>
            <input type="tel" id="phone" name="phone" pattern="[0-9]{10}" class="input-field">
            <span class="validation-error"></span>
        </div>
        
        <div class="form-group">
            <label for="subject">Subject*</label>
            <select id="subject" name="subject" required class="input-field">
                <option value="" disabled selected>Select a subject</option>
                <option value="General Inquiry">General Inquiry</option>
                <option value="Quote Request">Quote Request</option>
                <option value="Custom Order">Custom Order</option>
                <option value="Existing Order">Existing Order</option>
            </select>
            <span class="validation-error"></span>
        </div>
        
        <div class="form-group">
            <label for="message">Your Message*</label>
            <textarea id="message" name="message" rows="5" required minlength="10" class="input-field"></textarea>
            <span class="validation-error"></span>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary" id="submitBtn">
                <span id="btnText">Send Message</span>
                <div id="btnSpinner" class="spinner hidden">
                    <div class="spinner-dot"></div>
                    <div class="spinner-dot"></div>
                    <div class="spinner-dot"></div>
                </div>
            </button>
            
            <p class="form-note">
                <i class="fas fa-info-circle"></i> If the form doesn't work, please email us directly at 
                <a href="mailto:bpnaresh@gmail.com">bpnaresh@gmail.com</a>
            </p>
        </div>
    </form>
</div>

<style>
    /* Validation Styles */
    .validation-error {
        color: #e74c3c;
        font-size: 0.8rem;
        display: none;
        margin-top: 5px;
    }
    
    .input-field.invalid {
        border-color: #e74c3c;
    }
    
    .input-field.invalid + .validation-error {
        display: block;
    }
    
    /* Spinner Animation */
    .spinner {
        display: inline-flex;
        gap: 4px;
        margin-left: 10px;
    }
    
    .spinner-dot {
        width: 8px;
        height: 8px;
        background-color: white;
        border-radius: 50%;
        animation: bounce 1.4s infinite ease-in-out both;
    }
    
    .spinner-dot:nth-child(1) { animation-delay: -0.32s; }
    .spinner-dot:nth-child(2) { animation-delay: -0.16s; }
    
    @keyframes bounce {
        0%, 80%, 100% { transform: scale(0); }
        40% { transform: scale(1); }
    }
    
    .hidden {
        display: none;
    }
    
    .form-actions {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 20px;
    }
    
    .form-note {
        font-size: 0.85rem;
        color: #666;
    }
    
    .form-note i {
        margin-right: 5px;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('csfContactForm');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const btnSpinner = document.getElementById('btnSpinner');
    
    // Form validation
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Validate all fields
        let isValid = true;
        const requiredFields = form.querySelectorAll('[required]');
        
        requiredFields.forEach(field => {
            field.classList.remove('invalid');
            const errorMsg = field.nextElementSibling;
            
            if (field.value.trim() === '') {
                field.classList.add('invalid');
                errorMsg.textContent = 'This field is required';
                errorMsg.style.display = 'block';
                isValid = false;
            } else if (field.type === 'email' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(field.value)) {
                field.classList.add('invalid');
                errorMsg.textContent = 'Please enter a valid email address';
                errorMsg.style.display = 'block';
                isValid = false;
            } else if (field.id === 'phone' && field.value && !/^\d{10}$/.test(field.value)) {
                field.classList.add('invalid');
                errorMsg.textContent = 'Please enter a 10-digit phone number';
                errorMsg.style.display = 'block';
                isValid = false;
            } else {
                errorMsg.style.display = 'none';
            }
        });
        
        if (!isValid) return;
        
        // Show loading state
        submitBtn.disabled = true;
        btnText.textContent = 'Sending...';
        btnSpinner.classList.remove('hidden');
        
        try {
            // Try Formspree first
            const formspreeResponse = await fetch('https://formspree.io/f/bpnaresh@gmail.com', {
                method: 'POST',
                body: new FormData(form),
                headers: {
                    'Accept': 'application/json'
                }
            });
            
            if (formspreeResponse.ok) {
                // Success - redirect to thank you page
                window.location.href = '/thank-you.html';
                return;
            }
            
            // Fallback 1: FormSubmit
            const formsubmitResponse = await fetch('https://formsubmit.co/ajax/bpnaresh@gmail.com', {
                method: 'POST',
                body: new FormData(form),
                headers: {
                    'Accept': 'application/json'
                }
            });
            
            if (formsubmitResponse.ok) {
                window.location.href = '/thank-you.html';
                return;
            }
            
            // Fallback 2: Mailto link
            const formData = new FormData(form);
            const subject = encodeURIComponent(formData.get('subject'));
            const body = encodeURIComponent(
                `Name: ${formData.get('name')}\n\n` +
                `Email: ${formData.get('email')}\n\n` +
                `Phone: ${formData.get('phone')}\n\n` +
                `Message: ${formData.get('message')}`
            );
            
            window.location.href = `mailto:bpnaresh@gmail.com?subject=${subject}&body=${body}`;
            
        } catch (error) {
            console.error('Form submission error:', error);
            alert('Failed to send message. Please email us directly at bpnaresh@gmail.com');
        } finally {
            // Reset button state
            submitBtn.disabled = false;
            btnText.textContent = 'Send Message';
            btnSpinner.classList.add('hidden');
        }
    });
    
    // Real-time validation
    form.querySelectorAll('.input-field').forEach(field => {
        field.addEventListener('input', function() {
            if (this.checkValidity()) {
                this.classList.remove('invalid');
                this.nextElementSibling.style.display = 'none';
            }
        });
    });
});
</script>
